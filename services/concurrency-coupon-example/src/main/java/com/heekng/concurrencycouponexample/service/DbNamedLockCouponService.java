package com.heekng.concurrencycouponexample.service;import com.heekng.concurrencycouponexample.domain.CouponService;import com.heekng.concurrencycouponexample.repository.NamedLockRepository;import java.util.concurrent.TimeUnit;import lombok.RequiredArgsConstructor;import org.redisson.api.RLock;import org.redisson.api.RedissonClient;import org.springframework.stereotype.Service;/** * mysql named 락 * get_lock, release_lock 함수를 이용해 락을 사용한다. */@Service@RequiredArgsConstructorpublic class DbNamedLockCouponService {    private final NamedLockRepository namedLockRepository;    private final CouponService couponService;    public void appendCouponUser(Long couponId, Long userId) {        try {            namedLockRepository.getLock(couponId.toString());            couponService.appendCouponUser(couponId, userId);        } finally {            namedLockRepository.releaseLock(couponId.toString());        }    }}